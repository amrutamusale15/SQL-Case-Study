Use comapny;

CREATE TABLE cars (
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT
);

INSERT INTO cars (car_id, make, type, style, cost_$)
VALUES (1, 'Honda', 'Civic', 'Sedan', 30000),
(2, 'Toyota', 'Corolla', 'Hatchback', 25000),
(3, 'Ford', 'Explorer', 'SUV', 40000),
(4, 'Chevrolet', 'Camaro', 'Coupe', 36000),
(5, 'BMW', 'X5', 'SUV', 55000),
(6, 'Audi', 'A4', 'Sedan', 48000),
(7, 'Mercedes', 'C-Class', 'Coupe', 60000),
(8, 'Nissan', 'Altima', 'Sedan', 26000);

CREATE TABLE salespersons (
salesman_id INT PRIMARY KEY,
name VARCHAR(50),
age INT,
city VARCHAR(50)
);

INSERT INTO salespersons (salesman_id, name, age, city)
VALUES (1, 'John Smith', 28, 'New York'),
(2, 'Emily Wong', 35, 'San Fran'),
(3, 'Tom Lee', 42, 'Seattle'),
(4, 'Lucy Chen', 31, 'LA');

CREATE TABLE sales2 (
sale_id INT PRIMARY KEY,
car_id INT,
salesman_id INT,
purchase_date DATE,
FOREIGN KEY (car_id) REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)
);

INSERT INTO sales2 (sale_id, car_id, salesman_id, purchase_date)
VALUES (1, 1, 1, '2021-01-01'),
(2, 3, 3, '2021-02-03'),
(3, 2, 2, '2021-02-10'),
(4, 5, 4, '2021-03-01'),
(5, 8, 1, '2021-04-02'),
(6, 2, 1, '2021-05-05'),
(7, 4, 2, '2021-06-07'),
(8, 5, 3, '2021-07-09'),
(9, 2, 4, '2022-01-01'),
(10, 1, 3, '2022-02-03'),
(11, 8, 2, '2022-02-10'),
(12, 7, 2, '2022-03-01'),
(13, 5, 3, '2022-04-02'),
(14, 3, 1, '2022-05-05'),
(15, 5, 4, '2022-06-07'),
(16, 1, 2, '2022-07-09'),
(17, 2, 3, '2023-01-01'),
(18, 6, 3, '2023-02-03'),
(19, 7, 1, '2023-02-10'),
(20, 4, 4, '2023-03-01');

select * from sales2;

select * from cars;

select * from salespersons;

/* What are the details of all cars purchased in the year 2022?*/

select * from cars
join sales2 
on cars.car_id = sales2.car_id
where year(purchase_date) = 2022;

/* what is the total number of cars sold by each salesperson?*/

select sales2.salesman_id,
sp.name as salesperson,
count(sale_id) as total_cars_sold
from salespersons sp
join sales2
on sp.salesman_id = sales2.salesman_id
group by sp.name,sales2.salesman_id;

/* What is the total revenue generated by each salesperson?*/

select sales2.salesman_id,
salespersons.name,
sum(cost_$) as total_revenue
from salespersons
join sales2
on salespersons.salesman_id = sales2.salesman_id
join cars 
on sales2.car_id = cars.car_id
group by salespersons.name

/* What are the details of the cars sold by each salesman*/

select c.car_id,c.make,c.type,c.style,c.cost_$,
sales2.salesman_id,
sp.name
from salespersons sp
join sales2
on sp.salesman_id = sales2.salesman_id
join cars c
on sales2.car_id = c.car_id
group by c.car_id,c.make,c.type,c.style,c.cost_$,sp.name;

/* What is the total revenue generated by each car type?*/

select c.car_id, c.type, sum(cost_$) as total_revenue
from cars c
join sales2
on c.car_id = sales2.car_id
group by c.type,c.car_id;

/* What are the details of the cars sold in the year 2021 by 'Emily Wong'?*/

select salespersons.name,c.car_id,c.make,c.type,c.cost_$,c.style,
sales2.salesman_id
from cars c
join sales2
on c.car_id = sales2.car_id
join salespersons
on sales2.salesman_id = salespersons.salesman_id
where year(purchase_date)=2021 and salespersons.name ='emily wong';

/* What is the total revenue generated by the sales of hatchback cars?*/

select sum(cost_$) as total_revenue,style
from cars
join sales2
on cars.car_id = sales2.car_id
where style = 'hatchback';

/*What is the total revenue generated by the sales of SUV cars in the year 2022?*/

select sum(cost_$) as total_revenue_SUV_cars
from cars 
join sales2
on cars.car_id = sales2.car_id
where style = 'SUV' and year(purchase_date) = 2022;

/* What is the name and city  of the salespersons who sold the most number of cars in the year 2023?*/

select sp.salesman_id,sp.name,sp.city,count(sales2.sale_id) as total_car_sold_2023
from salespersons as sp
join sales2
on sp.salesman_id = sales2.salesman_id
where year(purchase_date) =2023
group by sp.salesman_id, sp.name,sp.city
order by sales2.sale_id desc limit 1;
 
/* What is the name and age of the salesperson who generated the highest revenue  in the year 2022?*/

select sp.name ,sp.age, sum(cost_$) as total_revenue_2022
from salespersons sp 
join sales2
on sp.salesman_id = sales2.salesman_id
join cars
on sales2.car_id = cars.car_id
where year(purchase_date) = 2022
group by sp.name,sp.age
order by sum(cost_$) desc
limit 1;
